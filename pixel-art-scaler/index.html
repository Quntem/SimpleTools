<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SimpleTools: Pixel Art Scaler - Scale your pixel art images easily and download them.">

  <link rel="icon" href="pixel scaler icon.png" type="image/png">
  <title>SimpleTools | Pixel Art Scaler</title>
  <meta name="description" content="Scale your pixel art easily with SimpleTools' Pixel Art Scaler. Maintain crispness and aspect ratio. Supports PNG, JPEG, GIF, and WEBP.">
  <meta name="keywords" content="Pixel Art, Scaler, Image Resize, Pixel Tool, SimpleTools, Scale PNG, Retro Art, Game Art Tools">
  <meta name="author" content="SimpleTools">
  <meta name="robots" content="index, follow">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jersey+25&display=swap" rel="stylesheet">

  <!-- <script src="https://unpkg.com/lucide@latest"></script> -->

  <link rel="stylesheet" href="index.css">
</head>

<header>
  <a href="/" style="text-decoration: none; color: inherit;">
    <div class="headContainer">
      <img src="/global/images/logo.png" alt="SimpleTools Logo" height="88" width="88">
      <div class="headContainer-title">
          <h1>SimpleTools</h1>
          <h2>Use a collection of simple tools by Quntem.</h2>
      </div>
    </div>
  </a>
</header>

<body>
  <div class="container">
    <!-- Actual Stuff -->
    <div style="display: flex; flex-direction: row; gap: 1rem; margin-bottom: 1rem;">
      <img src="pixel scaler icon.png" alt="Pixel Scaler Icon Logo" class="logo" width="48" height="48">
      <h1>Pixel Art Scaler</h1>
    </div>

    <p>Easily scale your pixel art to ensure it looks sharp and vibrant on social media platforms! Upload your image, adjust the scale factor or dimensions, and preview the results instantly.</p>

    <div class="file-input-container">
      <input type="file" id="fileInput" accept="image/png, image/jpeg, image/jpg, image/gif, image/webp">
      <div class="file-drop-area">
        <div class="file-option" style="display: flex; flex-direction: row; gap: .75rem;">
          <svg id="folder-icon" style="color: black;" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
            <path d="M4 4h8v2h10v14H2V4h2zm16 4H10V6H4v12h16V8z" fill="currentColor"/>
          </svg>
          
          <svg id="file-icon" style="color: black; display: none;" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
            <path d="M3 22h18V8h-2V6h-2v2h-2V6h2V4h-2V2H3v20zm2-2V4h8v6h6v10H5z" fill="currentColor"/>
          </svg>

          <p class="label" id="file-label">BROWSE FILE</p>
        </div>
        <p class="information" id="information">Press anywhere to start browsing through your files.</p>
        <p class="information" id="information2" style="margin-top: 0;">Supported formats: PNG, JPEG, JPG, GIF, WEBP</p>
      </div>
    </div>

    <div id="actions" style="display: none; flex-direction: row; margin: 2rem; gap: 3rem;">
      <canvas id="previewCanvas" class="preview" width="64" height="64"></canvas>

      <div style="display: flex; flex-direction: column; justify-content: center;">
        <div style="display: flex; flex-direction: row; gap: 1rem">
          <div id="clearButtonContainer" style="display: none; align-items: center;">
            <button onclick="clearSaved()" class="clear-saved-img-btn">üóëÔ∏è Clear Saved Image</button>
          </div>
  
          <a id="downloadLink" style="display:none;" download="SimpleTools [] Pixel Art Scaler [] (Name of original image name)" class="clearButtonContainer">
            <button class="clear-saved-img-btn">üîΩ Download Scaled Image</button>
          </a>
        </div>
  
        <div style="display: flex; flex-direction: row; gap: 1rem;">
            <div style="display: flex; flex-direction: column;">
              <label for="scaleInput" class="scaleInputText">SCALE</label>
              <input id="scaleInput" type="number" min="1" max="50" step="any" value="1" class="scaleInput"/>
            </div>
            <div style="display: flex; flex-direction: column;">
              <label class="scaleInputText">WIDTH</label>
              <input type="number" id="widthInput" min="1">
            </div>
            <div style="display: flex; flex-direction: column;">
              <label class="scaleInputText">HEIGHT</label>
              <input type="number" id="heightInput" min="1">
            </div>
            <button id="lockAspectRatioBtn" class="clear-saved-img-btn" style="margin-top: auto; margin-bottom: 0.25rem; font-size: 1rem;">üîí</button>
        </div>

        <span id="mismatchMessage" style="color: red; display: none; margin-top: .75rem; font-size: 1rem;"></span>
      </div>

      <canvas id="canvas"></canvas>
    </div>

    <!-- some guides and stuff -->

    <div class="guides">
      <div style="margin-top: 2rem; margin-bottom: 2rem;">
        <h2>How to Use:</h2>
        <ol>
          <li>Upload your pixel art image.</li>
          <li>Adjust the scale factor or dimensions as needed.</li>
          <li>Preview the scaled image in real-time.</li>
          <li>Download the scaled image when you're satisfied.</li>
        </ol>
      </div>

      <div style="margin-top: 2rem; margin-bottom: 2rem;">
        <h2>What is Pixel Art Scaler?</h2>
        <p>
          Pixel Art Scaler is a web application by SimpleTools to easily scale your pixel art to ensure it looks sharp and vibrant on social media platforms such as Discord, Twitter, and many more.
          It allows you to upload your pixel art image, adjust the scale factor or dimensions, and preview the results instantly.
          The tool is designed to maintain the crispness of pixel art while providing a user-friendly interface for scaling images.
        </p>
      </div>
      
      <div style="margin-top: 2rem; margin-bottom: 2rem;">
        <h2>What formats do we support?</h2>
        <p>We support PNG, JPEG, JPG, GIF, WEBP.
          Our server side won't actually check if your image uplaoded is one of those types, but other types may result in an error when uploading.</p>
      </div>
    </div>
  </div>

  <script>
    // elements
    const elements = {
      fileInput: document.getElementById("fileInput"),
      scaleInput: document.getElementById("scaleInput"),
      widthInput: document.getElementById("widthInput"),
      heightInput: document.getElementById("heightInput"),
      canvas: document.getElementById("canvas"),
      previewCanvas: document.getElementById("previewCanvas"),
      downloadLink: document.getElementById("downloadLink"),
      lockBtn: document.getElementById("lockAspectRatioBtn"),
      clearBtnContainer: document.getElementById("clearButtonContainer"),
      fileLabel: document.getElementById("file-label"),
      info: document.getElementById("information"),
      info2: document.getElementById("information2"),
      mismatchMessage: document.getElementById("mismatchMessage"),
      folderIcon: document.getElementById("folder-icon"),
      fileIcon: document.getElementById("file-icon"),
    };

    const ctx = elements.canvas.getContext("2d");
    const previewCtx = elements.previewCanvas.getContext("2d");

    let image = new Image();
    let aspectRatioLocked = true;
    let fileName = "pixel-art-scaler.png"; // default file name

    // initial setup
    window.addEventListener("DOMContentLoaded", loadSavedData);
    elements.fileInput.addEventListener("change", handleFileInput);
    elements.scaleInput.addEventListener("input", scaleImage);
    elements.widthInput.addEventListener("input", scaleImage);
    elements.heightInput.addEventListener("input", scaleImage);
    elements.lockBtn.addEventListener("click", toggleAspectRatioLock);

    fileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (file) {
          fileName = file.name;
          localStorage.setItem("pixelArtFileName", fileName);
      }
    });

    image.onload = onImageLoad;
    image.onerror = onImageError;

    // functions
    function loadSavedData() {
      const savedImage = localStorage.getItem("pixelArtImage");
      const savedScale = localStorage.getItem("pixelArtScale");
      const savedWidth = localStorage.getItem("pixelArtWidth");
      const savedHeight = localStorage.getItem("pixelArtHeight");
      const savedFileName = localStorage.getItem("pixelArtFileName");

      if (savedFileName) fileName = savedFileName;

      if (savedScale) elements.scaleInput.value = savedScale;
      if (savedWidth) elements.widthInput.value = savedWidth;
      if (savedHeight) elements.heightInput.value = savedHeight;
      if (savedImage) {
        image.src = savedImage;
        elements.clearBtnContainer.style.display = "flex";
      }
    
      updateIconsBasedOnLabel();
    }

    function onImageLoad() {
      if (!image.complete || !image.naturalWidth || !image.naturalHeight) {
        return console.error("Image dimensions not available.");
      }
    
      const { naturalWidth: w, naturalHeight: h } = image;
      elements.widthInput.value = w;
      elements.heightInput.value = h;
      elements.previewCanvas.width = w;
      elements.previewCanvas.height = h;
      elements.scaleInput.value = 1;
    
      updateInfoDisplay(w, h);
      elements.clearBtnContainer.style.display = "flex";
      updateIconsBasedOnLabel();
      elements.actions = document.getElementById("actions");
      elements.actions.style.display = "flex"; // <- SHOW when image is loaded
      scaleImage();
    }

    function onImageError() {
      console.error("Failed to load image.");
      elements.fileLabel.textContent = "IMAGE FAILED TO LOAD";
      updateIconsBasedOnLabel();
    }

    function handleFileInput(e) {
      const file = e.target.files[0];
      if (!file) return;
    
      const reader = new FileReader();
      reader.onload = (ev) => (image.src = ev.target.result);
      reader.readAsDataURL(file);
    }

    function toggleAspectRatioLock() {
      aspectRatioLocked = !aspectRatioLocked;
      updateLockButtonText();
      scaleImage();
    }

    function updateLockButtonText() {
      elements.lockBtn.textContent = aspectRatioLocked ? "üîí" : "üîì";
      elements.lockBtn.classList.toggle("locked", aspectRatioLocked);
    }

    function updateInfoDisplay(width, height) {
      const totalPx = width * height;
      const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
      const divisor = gcd(width, height);
      const ratio = `${width / divisor}:${height / divisor}`;
    
      elements.fileLabel.textContent = "FILE SELECTED";
      elements.info.textContent = `Original Image Dimensions: ${width} x ${height} (${totalPx} px)`;
      elements.info2.textContent = `Original Aspect Ratio: ${ratio} (${(width / height).toFixed(2)})`;
    }

    function scaleImage() {
      const { naturalWidth: ow, naturalHeight: oh } = image;
      let scale = parseFloat(elements.scaleInput.value);
      let width = parseInt(elements.widthInput.value);
      let height = parseInt(elements.heightInput.value);
      const active = document.activeElement;
    
      if (active === elements.scaleInput) {
        scale = clamp(scale, 1, 50);
        elements.scaleInput.value = scale;
        width = Math.round(ow * scale);
        height = Math.round(oh * scale);
        elements.widthInput.value = width;
        elements.heightInput.value = height;
        elements.scaleInput.disabled = false;
        showMismatchMessage(false);
      } else if (active === elements.widthInput || active === elements.heightInput) {
        width = clamp(width, ow, ow * 50);
        height = clamp(height, oh, oh * 50);
        elements.widthInput.value = width;
        elements.heightInput.value = height;
      
        if (aspectRatioLocked) {
          if (active === elements.widthInput) {
            height = Math.round(width / (ow / oh));
            elements.heightInput.value = height;
          } else {
            width = Math.round(height * (ow / oh));
            elements.widthInput.value = width;
          }
          scale = width / ow;
          elements.scaleInput.value = scale;
          elements.scaleInput.disabled = false;
          showMismatchMessage(false);
        } else {
          const scaleX = width / ow;
          const scaleY = height / oh;
        
          if (Number.isInteger(scaleX) && scaleX === scaleY) {
            scale = scaleX;
            elements.scaleInput.value = scale;
            elements.scaleInput.disabled = false;
            showMismatchMessage(false);
          } else {
            elements.scaleInput.disabled = true;
            showMismatchMessage(true);
          }
        }
      }
    
      drawCanvas(width, height, ow, oh);
      drawPreview(ow, oh);
      updateDownloadLink();
      saveToLocalStorage(scale, width, height);
    }

    function drawCanvas(w, h, ow, oh) {
      elements.canvas.width = w;
      elements.canvas.height = h;
      ctx.clearRect(0, 0, w, h);
      ctx.imageSmoothingEnabled = false;
      ctx.drawImage(image, 0, 0, ow, oh, 0, 0, w, h);
    }

    function drawPreview(ow, oh) {
      previewCtx.clearRect(0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
      previewCtx.imageSmoothingEnabled = true;
      previewCtx.drawImage(image, 0, 0, ow, oh, 0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
    }

    function updateDownloadLink() {
      elements.downloadLink.href = elements.canvas.toDataURL();
      elements.downloadLink.style.display = "inline-block";
      elements.downloadLink.download = 'SimpleTools [] Pixel Art Scaler [] ' + fileName;
    }

    function showMismatchMessage(show) {
      elements.mismatchMessage.style.display = show ? "block" : "none";
      if (show) {
        elements.mismatchMessage.textContent = "Aspect ratio mismatch! Adjust width and height to use scaling.";
      }
    }

    function saveToLocalStorage(scale, width, height) {
      if (image.src.startsWith("data:image")) {
        localStorage.setItem("pixelArtImage", image.src);
        localStorage.setItem("pixelArtScale", scale);
        localStorage.setItem("pixelArtWidth", width);
        localStorage.setItem("pixelArtHeight", height);
      }
    }

    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    function updateIconsBasedOnLabel() {
      const selected = elements.fileLabel.textContent.trim() === "FILE SELECTED";
      elements.folderIcon.style.display = selected ? "none" : "inline";
      elements.fileIcon.style.display = selected ? "inline" : "none";
    }

    function clearSaved() {
      localStorage.removeItem("pixelArtImage");
      localStorage.removeItem("pixelArtScale");
      localStorage.removeItem("pixelArtWidth");
      localStorage.removeItem("pixelArtHeight");
      localStorage.removeItem("pixelArtFileName");
      elements.clearBtnContainer.style.display = "none";
      location.reload();
    }
  </script>
</body>
</html>
